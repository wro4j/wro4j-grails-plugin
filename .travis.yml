language: groovy
jdk:
- oraclejdk7
before_script:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  # if we run on the same box as previous build, make sure target is clean
  - rm -rf target
script: ./grailsw refresh-dependencies --non-interactive
  && ./grailsw test-app --non-interactive
  && ./grailsw package-plugin --non-interactive
  && if [[ $TRAVIS_BRANCH == 'master' ]]; then ./grailsw publish-plugin --no-scm --non-interactive ; else echo "Not on master branch, so not publishing"; fi
env:
  global:
  # travis encrypt -a env.global 'GRAILS_CENTRAL_USERNAME=myusername'
  # travis encrypt -a env.global 'GRAILS_CENTRAL_PASSWORD=mypassword' 
  - secure: qScQg2sTyGKpe2JnLpYgffUS5VyGFSHMIhTL2SIZWsJtByHgA1JhpxIiTHSp0TFcHklVebTzdpwPCNyYmY+JaLA7Eiudz0FKxmUTzEdf99pBtSp4220beeBM2N7SE7fUyDR5tb5NgTvqYwocGqRCwBOtrFs94mLofYHtmJHQfkQ=
  - secure: NSoxSR0pJ3z6hhWwnI5OUt8ySIB+Ik8zmQ0CdFRpIETWgOqpOMxiwqQTL1SGYbEPu3DMqaBghlQTyFyFjEGgqpjb+dJJw9EMj9nYxyji1dasYSiyj0pWK5c0Jx1wJT7pPkO1pLSEnR1FCczohqJpuOCoAVdGAmT059r/2jYbdng=
